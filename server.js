// server.js (à¹„à¸Ÿà¸¥à¹Œà¸«à¸¥à¸±à¸à¸ªà¸³à¸«à¸£à¸±à¸šà¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸² Express à¹à¸¥à¸°à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¸à¸²à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥)

const express = require('express');
const mongoose = require('mongoose');
const cors = require('cors');
// à¹€à¸£à¸µà¸¢à¸à¹ƒà¸Šà¹‰ orderRoutes à¹€à¸žà¸·à¹ˆà¸­à¸ˆà¸±à¸”à¸à¸²à¸£ API endpoints
const orderRoutes = require('./routes/orderRoutes'); 

// à¹ƒà¸Šà¹‰ dotenv à¹€à¸žà¸·à¹ˆà¸­à¹‚à¸«à¸¥à¸”à¸•à¸±à¸§à¹à¸›à¸£à¸ªà¸ à¸²à¸žà¹à¸§à¸”à¸¥à¹‰à¸­à¸¡à¸ˆà¸²à¸à¹„à¸Ÿà¸¥à¹Œ .env (à¹€à¸Šà¹ˆà¸™ MONGODB_URI)
require('dotenv').config(); 

const app = express();
const PORT = process.env.PORT || 3000;

// ===================================
// 1. Middlewares (à¸à¸²à¸£à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¸•à¸±à¸§à¸à¸¥à¸²à¸‡)
// ===================================

// Middleware à¸ªà¸³à¸«à¸£à¸±à¸š CORS: à¸­à¸™à¸¸à¸à¸²à¸•à¹ƒà¸«à¹‰ Frontend (à¹‚à¸”à¹€à¸¡à¸™à¸­à¸·à¹ˆà¸™) à¹€à¸‚à¹‰à¸²à¸–à¸¶à¸‡ API à¹„à¸”à¹‰
// à¸«à¸²à¸à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸„à¸§à¸²à¸¡à¸›à¸¥à¸­à¸”à¸ à¸±à¸¢ à¹ƒà¸«à¹‰à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™ '*' à¹€à¸›à¹‡à¸™à¹‚à¸”à¹€à¸¡à¸™ Frontend à¸ˆà¸£à¸´à¸‡à¸‚à¸­à¸‡à¸„à¸¸à¸“
app.use(cors({
    origin: '*', 
}));

// Middleware à¸ªà¸³à¸«à¸£à¸±à¸šà¸à¸²à¸£à¸­à¹ˆà¸²à¸™ JSON: à¸—à¸³à¹ƒà¸«à¹‰ Express à¹€à¸‚à¹‰à¸²à¹ƒà¸ˆà¸‚à¹‰à¸­à¸¡à¸¹à¸¥ JSON à¸—à¸µà¹ˆà¸ªà¹ˆà¸‡à¸¡à¸²à¹ƒà¸™ body à¸‚à¸­à¸‡ request
app.use(express.json()); 

// ===================================
// 2. à¸à¸²à¸£à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­ MongoDB (Mongoose)
// ===================================

const MONGODB_URI = process.env.MONGODB_URI;

mongoose.connect(MONGODB_URI)
    .then(() => console.log('âœ… MongoDB connected successfully.'))
    .catch(err => {
        // à¸«à¸²à¸à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­ MongoDB à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ à¸ˆà¸°à¹à¸ªà¸”à¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡ Error à¹à¸¥à¸°à¸«à¸¢à¸¸à¸” Server
        console.error('âŒ MongoDB connection error:', err.message);
        process.exit(1); 
    });

// ===================================
// 3. Routes (à¸à¸²à¸£à¸à¸³à¸«à¸™à¸”à¹€à¸ªà¹‰à¸™à¸—à¸²à¸‡ API)
// ===================================

// à¹€à¸ªà¹‰à¸™à¸—à¸²à¸‡à¸žà¸·à¹‰à¸™à¸à¸²à¸™à¸ªà¸³à¸«à¸£à¸±à¸šà¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸ªà¸–à¸²à¸™à¸° Server
app.get('/', (req, res) => {
    res.send('The Boss Ingredient Ordering API is running!');
});

// à¸à¸³à¸«à¸™à¸”à¹€à¸ªà¹‰à¸™à¸—à¸²à¸‡à¸«à¸¥à¸±à¸à¸ªà¸³à¸«à¸£à¸±à¸š API à¸„à¸³à¸ªà¸±à¹ˆà¸‡à¸‹à¸·à¹‰à¸­à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”
// à¸—à¸¸à¸à¹† request à¸—à¸µà¹ˆà¸¡à¸²à¸—à¸µà¹ˆ /api/orders à¸ˆà¸°à¸–à¸¹à¸à¸ªà¹ˆà¸‡à¸•à¹ˆà¸­à¹„à¸›à¸¢à¸±à¸‡ orderRoutes.js
app.use('/api/orders', orderRoutes);


// ===================================
// 4. Start Server
// ===================================
app.listen(PORT, () => {
    console.log(`ðŸš€ Server is running on port ${PORT}`);
});